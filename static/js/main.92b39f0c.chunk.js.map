{"version":3,"sources":["RTCHAT/myMessage.js","components/textMessage.js","RTCHAT/RTC/message.js","RTCHAT/callStatus.js","RTCHAT/RTC/PeerConnectionManager.js","RTCHAT/RTC/messageTypes.js","RTCHAT/CALL_SIGNALING/callStatus.js","RTCHAT/CALL_SIGNALING/callPacket.js","RTCHAT/CALL_SIGNALING/CallSignalingManager.js","RTCHAT/communicator.js","proxy.js","components/businessLogic/myUser.js","RTCHAT/mySingleUserChat.js","RTCHAT/myGroupChat.js","store/reducers/chatReducer/index.js","RTCHAT/types.js","store/reducers/authReducer/index.js","store/reducers/index.js","store/index.js","RTCHAT/index.js","store/actions/authActions.js","components/singleChat.js","components/singleUserChat.js","components/videoChatScreen.js","App.js","serviceWorker.js","index.js"],"names":["MyMessage","this","_id","Math","random","from","to","body","status","SENDING","sentTimeDate","Date","now","seenTimeDate","type","TEXT","chatType","setAttributes","setValue","message","setAsGroupMessage","VIDEO","IMAGE","SENT","RECIEVED","SEEN","TextMessage","state","props","isMe","cid","backColor","foreColor","alignment","style","width","float","display","minWidth","maxWidth","backgroundColor","padding","marginTop","color","toLocaleTimeString","Component","payload","CallStatus","CALLING","RUNNING","ACCEPTED","CONNECTING","CONNECTED","ON_ANOTHER_CALL","DECLINED","PeerConnectionManager","communicatorContext","socketConnection","setChannelEnabled","kind","value","index","localStream","getTracks","findIndex","t","enabled","handleCommunication","socket","on","res","peerConnection","query","console","log","setRemoteDescription","RTCSessionDescription","then","recieveCall","catch","err","addIceCandidate","RTCIceCandidate","createConnection","myId","peerId","config","configuration","RTCPeerConnection","onicecandidate","event","candidate","callerId","sendMessage","onaddstream","stream","context","handelOnAddRemoteStream","peerStream","oniceconnectionstatechange","e","info","target","iceConnectionState","destroyConnection","forEach","track","stop","close","startCall","isFront","navigator","mediaDevices","enumerateDevices","sourceInfos","length","sourceInfo","facing","deviceId","getUserMedia","audio","video","handelOnAddLocalStream","addStream","createOffer","offerToReceiveAudio","offerToReceiveVideo","offer","setLocalDescription","createAnswer","answer","emit","getStream","iceServers","url","urls","username","credential","RINGING_REQUEST","RINGING","REJECTED","USEROFFLINE","USERONLINE","ON_OHTER_CALL","CallPacket","CallSignalingManager","communicatorSocket","handelSingnaling","packet","isBusy","handelOnAddCallStatus","createRTCConnection","startRTCCall","destroyRTCConnection","connetingPeer","ack","initializeSingnaling","Promise","resolve","reject","socketConnected","acceptSignaling","endCallSingnal","Communicator","dataHandler","ackEmitter","ackEmitters","rtcConfig","callSignalingManager","videoChatContext","rtcConnectionManager","connect","_dataHandler","_ackEmitter","_ackEmitters","io","RTCPeerConnectionManager","send","chatId","markSeen","messages","recieverCid","setState","isConnected","error","timeout","reason","attemptNumber","initializeSignaling","acceptCall","setChatContext","endCallSignal","recieverId","isVideo","setRTCChannelEnabled","remoteStream","callStatus","MyUser","phoneNumber","user","MySingleUserChat","title","selected","unseenCount","lastMessage","chatStatus","CHAT_NOT_FOUND","compose","sc1","sc2","chat","singleChat","setChat","setUser","USER_NOT_FOUND","USER_CHAT_FOUND","MyGroupChat","gcid","users","setTimeout","AddGroupChatListner","Chat","ChatReducer","mState","action","clone","ucId","ucIndex","uc","push","sort","a","b","friend","icbIndex","c","messageSent","ucsIndex","hindex","filter","msg","ackIndex","ackmIndex","m","msgs","statuss","ccid","acksIndex","markCounter","msgsIndex","element","seenmIndex","msgseen","obj","JSON","parse","stringify","AuthReducer","RootReducer","combineReducers","middleWare","thunk","initialState","store","window","__REDUX_DEVTOOLS_EXTENSION__","createStore","applyMiddleware","MyCommunicator","MyCommunicatorObj","MyGroupChatCommunicators","prepareChat","userId","axios","post","data","success","incomingChat","userChat","myChat","getState","newChat","iIndex","ic","icfound","mIndex","mc","mmIndex","mmc","mmcfound","iiIndex","iic","dispatch","connectChat","sentDataHandler","SingleChat","messageBody","handleSendMesage","onClick","friendId","height","fontSize","marginLeft","overflowY","map","key","onFocus","cIndex","onChange","borderRadius","placeholder","border","React","SingleUserChat","cursor","borderBottom","align","zIndex","textAlign","textOverflow","VideoCallingScreen","connectUser","alert","handleInitiateCall","endCall","answerCall","setSelected","id","configs","getSelected","callRunning","isMute","connectionState","iceTransports","peerConnectionA","myStream","srcObject","friendStream","innerHeight","alignSelf","ref","backfaceVisibility","autoPlay","position","bottom","right","left","innerWidth","className","Fragment","paddingLeft","margin","App","calling","handleConnect","sc","onConnect","handleConnectSocket","onSendMessage","handleSendMessage","reserved","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.92b39f0c.chunk.js","sourcesContent":["\r\nclass MyMessage{\r\n    static TEXT = \"TEXT\";\r\n    static VIDEO = \"VIDEO\";\r\n    static IMAGE = \"IMAGE\";\r\n\r\n\r\n    static SENDING = \"gray\";\r\n    static SENT = \"black\";\r\n    static RECIEVED = \"yellow\";\r\n    static SEEN = \"#0D4330\";\r\n\r\n    constructor(){\r\n        this._id = Math.random()*100000*Math.random();\r\n        this.from = \"\";\r\n        this.to = \"\";\r\n        this.body = \"\";\r\n        this.status = MyMessage.SENDING;\r\n        this.sentTimeDate = Date.now();\r\n        this.seenTimeDate = null\r\n        this.type = MyMessage.TEXT;\r\n        this.chatType = \"single\"\r\n        this.setAttributes = (from, to, body) => {\r\n            this.from = from;\r\n            this.to = to;\r\n            this.body = body;\r\n            return this;\r\n        }\r\n        \r\n        this.setValue = (message) => {\r\n            this._id = message._id;\r\n            this.from =message.from;\r\n            this.to = message.to;\r\n            this.body = message.body;\r\n            this.status = message.status;\r\n            this.type = message.type;\r\n            return this;\r\n        }\r\n        this.setAsGroupMessage = () => {\r\n            this.chatType = \"group\";\r\n            return this;\r\n        }\r\n    }\r\n\r\n}\r\nexport default MyMessage;","import React, { Component } from 'react';\r\nimport MyMessage from '../RTCHAT/myMessage';\r\nconst PRIMARY = \"#5BBC93\"\r\nconst SECONDRY = \"#F2F3F8\";\r\n\r\n\r\n\r\nclass TextMessage extends Component {\r\n    state = {  }\r\n    render() { \r\n        const message = this.props.message?this.props.message: new MyMessage().setAttributes(\"\", \"a\", \"abasdfasdf asdfasdfasdfs dfasdfasdfasdf asdfasdfasdfasd fasdfasdfasd fasdfasdfc dedfsadf\") ;\r\n        const isMe = this.props.cid === message.from;\r\n        const backColor = isMe? SECONDRY:  PRIMARY\r\n        const foreColor = isMe? PRIMARY:  SECONDRY\r\n        const alignment = isMe? \"right\": \"left\";\r\n\r\n        return ( \r\n            <div style={{width: \"100%\", float: \"left\"}}>\r\n                <div style={{display: \"block\",minWidth: \"40%\", maxWidth: \"70%\" , float: alignment, backgroundColor: backColor, padding: 10, marginTop: 5 }}>\r\n                    <span style={{color: foreColor}}> {message.body}</span>\r\n                    <span style={{float: \"right\", color: message.status}}>{\" \"+new Date(message.sentTimeDate).toLocaleTimeString()} o</span>\r\n                </div>\r\n            </div>\r\n         \r\n         );\r\n    }\r\n}\r\n \r\nexport default TextMessage;","class MyMessage\r\n{\r\n    constructor(type, payload, to){\r\n        this.type = type;\r\n        this.payload = payload;\r\n        this.to = to;\r\n    }\r\n}\r\nexport default MyMessage;","class CallStatus{\r\n    static CALLING = 0;\r\n    static RUNNING = 1;\r\n    static ACCEPTED = 2;\r\n    static CONNECTING = 3;\r\n    static CONNECTED = 4;\r\n    static ON_ANOTHER_CALL = 5;\r\n    static DECLINED = 6;\r\n}\r\nexport default CallStatus;","// import { RTCPeerConnection, mediaDevices, RTCIceCandidate, RTCSessionDescription } from 'react-native-webrtc';\r\n\r\nimport { OFFER, ANSER, CALLER_ICE, RECIEVER_ICE} from './messageTypes';\r\nimport MyMessage from './message';\r\nimport CallStatus from '../callStatus';\r\n\r\n// {\r\n//     urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n//     username: 'a9a2b514',\r\n//     credential: '00163e7826d6'\r\n//     }\r\nclass PeerConnectionManager \r\n{\r\n  \r\n    constructor(communicatorContext, socketConnection ){\r\n        this.socket = socketConnection;\r\n        this.myId = null;\r\n        this.peerId = null;\r\n        this.localStream = null;\r\n        this.peerStream = null;\r\n        this.context = communicatorContext;\r\n        // this.configuration = {iceServers: [{url: \"stun:stun.l.google.com:19302\"}]};\r\n        this.configuration = {iceServers: [\r\n            {url: \"stun:stun.l.google.com:19302\"}, \r\n            {\r\n                urls: \"turn:numb.viagenie.ca\", \r\n                username: \"ata.mirza40@gmail.com\", \r\n                credential: \"ataMirza12345_\"\r\n            }\r\n            ]};\r\n      \r\n        this.peerConnection = null;\r\n        this.handleCommunication();\r\n    }\r\n\r\n    setChannelEnabled = (kind, value) => {\r\n       let index = (this.localStream.getTracks() || []).findIndex(t => t.kind === kind);\r\n       if(index >=0){\r\n           this.localStream.getTracks()[index].enabled = value;\r\n       }\r\n    }\r\n\r\n    handleCommunication = () =>{\r\n       \r\n        this.socket.on(\"onRecieveRTCMessage\", (res) => {\r\n            if(this.peerConnection){\r\n         \r\n            let message = res.query;\r\n            switch(message.type)\r\n            {\r\n                case OFFER: // RECIEVER\r\n                    console.log(\"STEP-1: RECIEVE OFFER\");\r\n                    console.log(message);\r\n                    console.log(\"---Adding offer to peer connection\")\r\n                    this.peerConnection.setRemoteDescription(new RTCSessionDescription(message.payload))\r\n                        .then(() => {\r\n                           console.log(\"---added remote offer\")\r\n                           this.recieveCall();\r\n                        }).catch(err => {\r\n                            console.log(\"CATCH- error in setting remote offer\");\r\n                            console.log(err)\r\n                        })\r\n                    break;\r\n                case ANSER: // CALLER\r\n                    console.log(\"STEP-4: ANSER RECIEVED\");\r\n                    this.peerConnection.setRemoteDescription(new RTCSessionDescription(message.payload))\r\n                        .then(() => {\r\n                            console.log(\"---added remote answer\")\r\n\r\n                            //// EMIT CALL STARTING......\r\n\r\n                        }).catch(err => {\r\n                            console.log(\"CATCH- error in setting remote answer\");\r\n                            console.log(err)\r\n                        })\r\n                    break;\r\n                case CALLER_ICE: // RECIEVER\r\n                    this.peerConnection.addIceCandidate(new RTCIceCandidate(message.payload))\r\n                        .then(() => {\r\n                            console.log(\"++++++++ICE ADDED: RECIEVER\")\r\n                        }).catch(err => {\r\n                            console.log(\"CATCH- error in setting remote Reciever ice candidate\");\r\n                            console.log(err)\r\n                        })\r\n                    break;\r\n                case RECIEVER_ICE:  // CALLER\r\n                    console.log(\"++++++++ICE ADDED\");\r\n                    this.peerConnection.addIceCandidate(new RTCIceCandidate(message.payload))\r\n                        .then(() => {\r\n                            console.log(\"++++++++ICE ADDED: CALLER\")\r\n                        }).catch(err => {\r\n                            console.log(\"CATCH- error in setting remote Caller ice candidate\");\r\n                            console.log(err)\r\n                        })\r\n                    break;\r\n                default: \r\n                    break;\r\n            }\r\n        }else{\r\n            console.log(\"PEER CONNECTION NOT INITIALIZED\");\r\n        }\r\n        })\r\n\r\n       \r\n\r\n       \r\n    }\r\n\r\n    createConnection  = (myId, peerId, config = null) => {\r\n        this.myId = myId;\r\n        this.peerId = peerId;\r\n        if(config !== null){\r\n            this.configuration = config;\r\n        }\r\n        console.log(\"CONFIGS\");\r\n        console.log(this.configuration);\r\n        this.peerConnection = new RTCPeerConnection(this.configuration);\r\n        this.peerConnection.onicecandidate = (event) => {\r\n            if(event.candidate){\r\n                if(this.callerId){\r\n                    this.sendMessage(new MyMessage(CALLER_ICE, event.candidate, this.peerId));                \r\n                }else{\r\n                    this.sendMessage(new MyMessage(RECIEVER_ICE, event.candidate, this.peerId));\r\n                }\r\n            }\r\n        }\r\n\r\n        this.peerConnection.onaddstream = event => {\r\n            console.log(\"Streaming...!!!\");\r\n            console.log(event.stream);\r\n            this.context.handelOnAddRemoteStream(event.stream)\r\n            this.peerStream = event.stream;\r\n        }\r\n        this.peerConnection.oniceconnectionstatechange = (e) => {\r\n            console.info('ICE Connection State Changed:', e.target.iceConnectionState)\r\n            switch (e.target.iceConnectionState) {\r\n              case 'closed':\r\n              case 'disconnected':\r\n              case 'failed':\r\n                  console.log(\"FAILD, Disconnected OR closed\");\r\n                break\r\n            }\r\n        }\r\n    \r\n    \r\n    }\r\n    destroyConnection = () => {\r\n        // this.setChannelEnabled(\"video\", false);\r\n        // this.setChannelEnabled(\"audio\", false);\r\n        if(this.localStream){\r\n            this.localStream.getTracks().forEach(function(track) {\r\n                track.stop();\r\n            });\r\n        }\r\n        if(this.peerConnection){\r\n            this.peerConnection.close();\r\n            this.peerConnection = null;\r\n            this.localStream = null;\r\n            this.peerStream = null;\r\n            this.peerId = null;\r\n        }\r\n        // this.peerConnection = null;\r\n        // this.peerId = null;\r\n        // this.localStream = null;\r\n        // this.peerStream = null;\r\n       \r\n    }\r\n\r\n\r\n    startCall = ( isFront, isVideo = true) => {\r\n        this.callerId = true;\r\n        console.log(\"STEP-1: Turning On Cam\")\r\n        let videoSourceId = null;\r\n       navigator.mediaDevices.enumerateDevices().then(sourceInfos => {\r\n            console.log(\"Source Infos\");\r\n            console.log(sourceInfos);\r\n            for (let index = 0; index < sourceInfos.length; index++) {\r\n                const sourceInfo = sourceInfos[index];\r\n                if(sourceInfo.kind == \"videoinput\" && sourceInfo.facing == (isFront? \"front\": \"back\")){\r\n                  videoSourceId = sourceInfo.deviceId;\r\n                }\r\n                \r\n            }\r\n\r\n        })\r\n        navigator.mediaDevices.getUserMedia({\r\n            audio: true,\r\n            video: true\r\n        }).then(stream => {\r\n            this.localStream = stream;\r\n            this.context.handelOnAddLocalStream(stream);\r\n            \r\n            console.log(\"STEP-2: ADDING STREAM TO PEER CONNECTION\");\r\n            this.peerConnection.addStream(this.localStream);\r\n            console.log(stream);\r\n\r\n            console.log(\"STEP-3: CREATING OFFER\")\r\n            this.peerConnection.createOffer({offerToReceiveAudio: true, offerToReceiveVideo: true})\r\n                .then(offer => {\r\n                    this.sendMessage(new MyMessage(OFFER, offer, this.peerId) );\r\n                    this.peerConnection.setLocalDescription(offer)\r\n                        .then(() => {\r\n                            console.log(\"---Offer- locally added\");\r\n                        }).catch(err=> {\r\n                            console.log(\"CATCH-error in adding offer\")\r\n                        })\r\n                }).catch(err => {\r\n                    console.log(\"CATCH- error in creating offer\");\r\n                    console.log(err);\r\n                })\r\n        })\r\n    }\r\n\r\n\r\n    recieveCall = () => {\r\n        this.callerId = false;\r\n        let videoSourceId = null;\r\n        let isFront = true;\r\n\r\n        navigator.mediaDevices.enumerateDevices().then(sourceInfos => {\r\n            console.log(\"Source Infos\");\r\n            console.log(sourceInfos);\r\n            for (let index = 0; index < sourceInfos.length; index++) {\r\n                const sourceInfo = sourceInfos[index];\r\n                if(sourceInfo.kind == \"videoinput\" && sourceInfo.facing == (isFront? \"front\": \"back\")){\r\n                  videoSourceId = sourceInfo.deviceId;\r\n                }\r\n                \r\n            }\r\n        })\r\n        navigator.mediaDevices.getUserMedia({\r\n            audio: true,\r\n            video: true\r\n        }).then(stream => {\r\n            this.localStream = stream;\r\n            this.context.handelOnAddLocalStream(stream);\r\n\r\n            console.log(\"STEP-2: ADDING STREAM TO PEER CONNECTION\");\r\n            this.peerConnection.addStream(this.localStream);\r\n\r\n\r\n            console.log(\"STEP-3: CREATING ANSWER\");\r\n            this.peerConnection.createAnswer({offerToReceiveAudio: true, offerToReceiveVideo: true})\r\n                .then(answer =>{\r\n                    console.log(answer);\r\n                    this.sendMessage(new MyMessage(ANSER, answer, this.peerId));\r\n                    console.log(\"---adding answer to description\");\r\n                    this.peerConnection.setLocalDescription(answer)\r\n                            .then(() => {\r\n                                console.log(\"---answer added locally\");\r\n                            }).catch(err =>{\r\n                                console.log(\"CATCH- error in adding answer locally\");\r\n                                console.log(err);\r\n                            })\r\n                }).catch(err =>{\r\n                    console.log(\"CATCH-error in creating answer\");\r\n                    console.log(err);\r\n                })\r\n\r\n        });\r\n\r\n    }\r\n\r\n\r\n   \r\n    sendMessage = (message) => {\r\n        console.log(\"---Sending message of type: \"+ message.type)\r\n        console.log(message);\r\n        this.socket.emit(\"onSendRTCMessage\", {query: message });\r\n    }\r\n\r\n\r\n    getStream = () => {\r\n        return this.localStream;\r\n    }\r\n\r\n}\r\nexport default PeerConnectionManager;\r\n\r\n\r\n","export const OFFER = \"OFFER\";\r\nexport const ANSER = \"ANSWER\";\r\nexport const CALLER_ICE = \"CALLER_ICE\";\r\nexport const RECIEVER_ICE = \"RECIEVER_ICE\";","class CallStatus{\r\n    static RINGING_REQUEST = 0;\r\n    static RINGING  = 2;\r\n    static ACCEPTED = 3;\r\n    static REJECTED = 4;\r\n    static USEROFFLINE = 5;\r\n    static USERONLINE = 6;\r\n    static ON_OHTER_CALL = 7;\r\n\r\n}\r\nexport default CallStatus;","class CallPacket{\r\n    constructor(type, to, from){\r\n        this.type = type;\r\n        this.to = to;\r\n        this.from = from;\r\n    }\r\n}\r\nexport default CallPacket;","import CallStatus from \"./callStatus\";\r\nimport CallPacket from \"./callPacket\";\r\n\r\nclass CallSignalingManager{\r\n    constructor(communicatorSocket, communicatorContext){\r\n        this.socket = communicatorSocket;\r\n        this.context = communicatorContext;\r\n        this.peerId = null;\r\n        this.isBusy = false;\r\n\r\n        this.handelSingnaling();\r\n    }\r\n\r\n\r\n    handelSingnaling = () => {\r\n        this.socket.on(\"onListen\", res => {\r\n            let packet =res.query;\r\n\r\n            switch(packet.type){\r\n                case CallStatus.RINGING_REQUEST: //// RECIEVER\r\n                    if(this.isBusy){\r\n                        this.socket.emit(\"onCommunicate\", {query: new CallPacket(CallStatus.ON_OHTER_CALL, packet.from, this.context.cid)})\r\n                    }else{\r\n                        this.isBusy = true;\r\n                        this.context.handelOnAddCallStatus(CallStatus.RINGING_REQUEST)\r\n                        this.peerId = packet.from;\r\n                        console.log(\"INCOMMING CALL: RING REQUEST\")   \r\n                        //// create RTC Connection here,\r\n                        console.log(\"CREATING RTC CONNECTION: RECIVER\")\r\n                        this.context.createRTCConnection(packet.from)\r\n                        //// show window ringing \r\n                        this.socket.emit(\"onCommunicate\", {query: new CallPacket(CallStatus.RINGING, packet.from, this.context.cid)})\r\n                    }\r\n                    \r\n                    break;\r\n                \r\n                case CallStatus.RINGING:  ////////   CALLER \r\n                this.isBusy = true;\r\n                this.context.handelOnAddCallStatus(CallStatus.RINGING)\r\n\r\n                    ////// UPDATE STATUS ///// ringing.... \r\n                    console.log(\"CALL: RINGING...\")\r\n                    break;\r\n                \r\n                case CallStatus.ACCEPTED: ///// CALLER \r\n                this.isBusy = true;\r\n                this.context.handelOnAddCallStatus(CallStatus.ACCEPTED)\r\n\r\n                    console.log(\"CALL: ACCEPTED\")\r\n                    ///// Start RTC Call...... \r\n                    this.context.startRTCCall(true)\r\n                    break;\r\n                case CallStatus.REJECTED: \r\n                    this.isBusy = false;\r\n                    this.context.handelOnAddCallStatus(CallStatus.REJECTED);\r\n                    this.context.destroyRTCConnection();\r\n                    break;\r\n                case CallStatus.ON_OHTER_CALL: \r\n                    this.isBusy = false;\r\n                    this.context.handelOnAddCallStatus(CallStatus.ON_OHTER_CALL);\r\n                    this.context.destroyRTCConnection();\r\n                    break;\r\n                default: \r\n                    break;\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n\r\n    connetingPeer = () => {\r\n        console.log(\"Connecting...\")\r\n        this.context.handelOnAddCallStatus(CallStatus.RINGING);\r\n        this.socket.emit(\"onCommunicate\", {query: new CallPacket(CallStatus.RINGING_REQUEST, this.peerId, this.context.cid )}, (ack) =>{\r\n            if(ack.type === CallStatus.USEROFFLINE){\r\n                console.log(\"PEER OFFLINE: RECONNECTING\")\r\n                this.connetingPeer(this.peerId)\r\n            }else{\r\n                console.log(\"PEER: ONLINE\")\r\n                \r\n                //// CAN TRIGGER RINGIN HERE \r\n               \r\n            }\r\n        } )\r\n    }\r\n\r\n    initializeSingnaling = (to) => {\r\n        this.peerId = to;\r\n        this.isBusy = true;\r\n        console.log(\"STEP1: initializing signaling\")\r\n        return new Promise((resolve, reject) => {\r\n            if(this.context.socketConnected){\r\n                console.log(\"Me: CONNECTED\")\r\n                //// start signaling, create RTC connection\r\n                console.log(\"CREATING RTC CONNECTION: CALLER\")\r\n                this.context.createRTCConnection(to);\r\n                this.connetingPeer(to);\r\n                resolve(true);\r\n            }else{\r\n                console.log(\"Me: NOT CONNECTED\")\r\n                reject(false);\r\n            }  \r\n        })                                     \r\n    }\r\n\r\n    acceptSignaling = () => {\r\n        this.isBusy = true;\r\n        return new Promise((resolve, reject) => {\r\n            this.socket.emit(\"onCommunicate\", {query: new CallPacket(CallStatus.ACCEPTED, this.peerId, this.context.cid)}, (ack) => {\r\n                if(ack.type === CallStatus.USERONLINE){\r\n                    //////  START RTC CaLL\r\n                    resolve(true);\r\n                }else{\r\n                    reject(false);\r\n                    ////// reconnecting.....and restoring\r\n                }\r\n            });\r\n        })\r\n    }\r\n    endCallSingnal = (to) => {\r\n        this.socket.emit(\"onCommunicate\", {query: new CallPacket(CallStatus.REJECTED, this.peerId, this.context.cid)});\r\n        this.context.handelOnAddCallStatus(CallStatus.REJECTED);\r\n        this.isBusy = false;\r\n        this.peerId = null;\r\n    }\r\n}\r\nexport default CallSignalingManager;","import io from \"socket.io-client\"\r\nimport MyMessage from \"./myMessage\";\r\nimport RTCPeerConnectionManager from './RTC/PeerConnectionManager';\r\nimport CallSignalingManager from \"./CALL_SIGNALING/CallSignalingManager\";\r\nimport { BASEURL } from \"../proxy\";\r\nclass Communicator {\r\n    constructor(){\r\n        this.socket = null\r\n        this.dataHandler = null;\r\n        this.ackEmitter = null;\r\n        this.ackEmitters = null;\r\n        this.cid = null;\r\n        this.socketConnected = false\r\n        this.rtcConfig = {iceServers: [\r\n          {url: \"stun:stun.l.google.com:19302\"}, \r\n          {\r\n            urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n            username: 'a9a2b514',\r\n            credential: '00163e7826d6'\r\n          }\r\n          ]}\r\n        ///// Video/Audio chat variables \r\n        this.callSignalingManager = false;\r\n\r\n        this.videoChatContext = null; \r\n        //// Initializing rtcConnectionManager on conncting to socket at this.socket.on(\"connect\"() => initizligin) \r\n        this.rtcConnectionManager = null\r\n      \r\n\r\n\r\n\r\n        this.connect = (cid, _dataHandler, _ackEmitter, _ackEmitters) => {\r\n            this.cid = cid;\r\n            this.dataHandler = _dataHandler;\r\n            this.ackEmitter = _ackEmitter;\r\n            this.ackEmitters = _ackEmitters;\r\n            this.socket = io(BASEURL, {query: {cid: cid}})\r\n            this.rtcConnectionManager = new RTCPeerConnectionManager(this, this.socket) ;\r\n            this.callSignalingManager = new CallSignalingManager(this.socket, this);\r\n          \r\n            this.send = (message, chatId) => {\r\n                console.log(\"EMIT ON SENT\")\r\n                this.socket.emit(\"onMessageSent\", {query: {message: message, chatId: chatId }}, (ack) => {\r\n                    this.ackEmitter(ack.message, MyMessage.SENT)\r\n                }) ;\r\n                console.log(\"onSentCalled\")\r\n                this.dataHandler(message);\r\n            }\r\n\r\n            this.markSeen = (messages, recieverCid) => {\r\n                this.socket.emit(\"onMarkSeenSent\", {query: {messages: messages, to: recieverCid, from: this.cid}}, (ack) => {\r\n                    this.ackEmitters(messages, recieverCid ,MyMessage.SEEN);\r\n                })\r\n            }\r\n\r\n\r\n            this.socket.on(\"onRecieveMessage\", (res) => {\r\n                console.log(\"onRecieve: called\")\r\n                let query = res.query;\r\n                this.socket.emit(\"onRecievedAckSend\", {query: {message: {_id: query.message._id, to: query.message.to, from: query.message.from}}})\r\n                this.dataHandler(query.message);\r\n            })\r\n            \r\n            this.socket.on(\"onRecievedAck\", (res) => {\r\n                this.ackEmitter(res.query.message, MyMessage.RECIEVED)\r\n            })\r\n          \r\n            this.socket.on(\"onMarkSeen\", (res) => {\r\n                this.ackEmitters(res.query.messages, res.query.from, MyMessage.SEEN)\r\n            })\r\n          \r\n          \r\n          \r\n          \r\n          \r\n          \r\n          \r\n          \r\n          \r\n          \r\n          \r\n          //////// Connections Managers ////////////////////////////////////////////////////\r\n          \r\n            this.socket.on(\"connect\", () => {\r\n                console.log(\"STATUS: CONNECTED\")\r\n                this.socketConnected = true;\r\n                this.videoChatContext.setState({isConnected: true})\r\n                // this.rtcConnectionManager = new RTCPeerConnectionManager(this, this.socket) ;\r\n            })\r\n\r\n            this.socket.on(\"connect_error\", (error) => {\r\n                console.log(\"CONNECT: ERROR\")\r\n                this.socketConnected = false;\r\n                console.log(error);\r\n            })\r\n\r\n            this.socket.on(\"connect_timeout\", (timeout) => {\r\n                console.log(\"CONNECT: TIMEOUT\");\r\n                console.log(timeout);\r\n            })\r\n\r\n            this.socket.on('disconnect', (reason) => {\r\n                if (reason === 'io server disconnect') {\r\n                  // the disconnection was initiated by the server, you need to reconnect manually\r\n                  this.socket.connect();\r\n                }\r\n                // else the socket will automatically try to reconnect\r\n              });\r\n\r\n              this.socket.on('reconnect', (attemptNumber) => {\r\n                console.log(\"SOCKET: RECONNECTED\")\r\n                console.log(attemptNumber)\r\n              });\r\n\r\n\r\n              this.socket.on('reconnect_attempt', (attemptNumber) => {\r\n                console.log(\"RECONNECT ATTEMPTS\")\r\n                console.log(attemptNumber);\r\n              });\r\n\r\n\r\n              this.socket.on('reconnecting', (attemptNumber) => {\r\n                console.log(\"RECONNECTING...\")\r\n              });\r\n\r\n              this.socket.on('reconnect_error', (error) => {\r\n                console.log(\"RECONNECT ERROR\")\r\n              });\r\n           \r\n        }\r\n\r\n\r\n        //////// Video Chat Listners \r\n\r\n\r\n        //////// EXPOSED FUNCTIONS /////// \r\n        this.initializeSignaling = (to) => {\r\n          this.callSignalingManager.initializeSingnaling(to)\r\n        }\r\n        this.acceptCall = () => {\r\n          this.callSignalingManager.acceptSignaling()\r\n        }\r\n        this.setChatContext = (context) => {\r\n          this.videoChatContext = context;\r\n        } \r\n        this.endCallSignal = () => {\r\n          this.callSignalingManager.endCallSingnal()\r\n        }\r\n\r\n        /////////////////  /////////////\r\n        ///// DONT USE BELOW FUNCTIONS \r\n\r\n        this.createRTCConnection = (recieverId) => {\r\n          this.rtcConnectionManager.createConnection(this.cid, recieverId, this.rtcConfig)\r\n          //////// SHOW WINDOW \r\n        }\r\n\r\n        this.startRTCCall = (isVideo) => {\r\n          this.rtcConnectionManager.startCall(isVideo);\r\n        }\r\n      \r\n\r\n        this.setRTCChannelEnabled = (kind, value) => {\r\n          this.rtcConnectionManager.setChannelEnabled(kind, value);\r\n        }\r\n        this.destroyRTCConnection = () => {\r\n          //// TODO : \r\n          /// communicate partner of this.\r\n          this.rtcConnectionManager.destroyConnection();\r\n        }\r\n\r\n\r\n        this.handelOnAddRemoteStream = (remoteStream) => {\r\n          //////// send it to chatContext\r\n          this.videoChatContext.setState({peerStream: remoteStream});\r\n        }\r\n        this.handelOnAddLocalStream = (localStream) => {\r\n          //////// send it to context\r\n          this.videoChatContext.setState({localStream: localStream});\r\n        }\r\n        this.handelOnAddCallStatus = (status) => {\r\n          //// CALL status from Class: CallStatus\r\n          console.log(\"CALL STATUS \"+ status)\r\n          this.videoChatContext.setState({callStatus: status});\r\n        }\r\n\r\n\r\n    \r\n\r\n\r\n      \r\n    }\r\n}\r\n\r\nexport default Communicator;","// export const BASEURL = \"http://localhost:5000\";\r\nexport const BASEURL = \"https://niofoxvideochatserver.herokuapp.com/\";","class MyUser{\r\n    constructor(){\r\n        this._id = \"\";\r\n        this.username = \"\";\r\n        this.phoneNumber = \"\";\r\n        \r\n        this.setAttributes = (_id, username) => {\r\n            this._id  = _id;\r\n            this.username = username;\r\n            return this;\r\n        }\r\n        this.setValue = (user) => {\r\n            this._id = user._id;\r\n            this.username = user.username;\r\n            this.phoneNumber = user.phoneNumber;\r\n            return this;\r\n        }\r\n    }\r\n}\r\nexport default MyUser;","import MyMessage from \"./myMessage\";\r\nimport MyUser from \"../components/businessLogic/myUser\";\r\n\r\nclass MySingleUserChat{\r\n    static USER_NOT_FOUND = 0;\r\n    static CHAT_NOT_FOUND = 1;\r\n    static USER_CHAT_FOUND = 2;\r\n\r\n    constructor(user = {_id:\"\", username: \"\"}){\r\n        this._id = \"\";\r\n        this.cid = user._id;\r\n        this.title=user.username;\r\n        this.user = user;\r\n        this.messages =  [];\r\n        this.selected = false;\r\n        this.unseenCount = 0;\r\n        this.lastMessage = new MyMessage();\r\n        this.chatType = \"single\";\r\n        this.chatStatus = MySingleUserChat.CHAT_NOT_FOUND;\r\n        \r\n        this.setAttributes = ( messages, selected, unseenCount = 0) => {\r\n            this.user =user;\r\n            this.cid = user._id ;\r\n            this.title=user.username;\r\n            this.messages = messages;\r\n            this.selected = selected;\r\n            this.unseenCount = unseenCount;\r\n            return this;\r\n        }\r\n        this.compose = (sc1, sc2) => {\r\n             this.cid = sc1.cid;\r\n             this.title = sc1.title;\r\n             this.user = sc1.user;\r\n\r\n            if(sc2.chat){\r\n                this._id = sc2.chat._id;\r\n                this.messages = sc2.chat.messages;\r\n                this.chatStatus = sc2.chatStatus;\r\n                this.unseenCount =sc2.unseenCount;\r\n                if(this.messages.length > 0){\r\n                    this.lastMessage = new MyMessage().setValue(this.messages[this.messages.length -1]);\r\n                }\r\n            }\r\n            console.log(\"VALUE\")\r\n            console.log(this);\r\n            return this;\r\n        }\r\n        this.setValue = (singleChat) => {\r\n            this.cid = singleChat._id;\r\n            this.user = singleChat.user;\r\n            this.messages =singleChat.chat;\r\n            this.selected = false;\r\n            this.unseenCount = 0\r\n            return this;\r\n        }\r\n        this.setChat = (singleChat) => {\r\n            if(singleChat){\r\n                this.cid = singleChat._id;\r\n                this.messages =singleChat.chat;\r\n                this.title = singleChat.title;\r\n                this.selected = false;\r\n                this.unseenCount = 0\r\n            }else{\r\n                this.cid = \"\";\r\n                this.messages =[];\r\n                this.selected = false;\r\n                this.unseenCount = 0\r\n            }\r\n           \r\n            return this;\r\n        }\r\n        this.setUser = (user) => {\r\n            this.user = new MyUser().setValue(user);\r\n            return this;\r\n        }\r\n    }\r\n}\r\nexport default MySingleUserChat;","import MyMessage from \"./myMessage\";\r\nimport {AddGroupChatListner} from './index'\r\nclass MyGroupChat{\r\n    constructor( gcid ){\r\n        this._id = gcid;\r\n        this.cid = gcid;\r\n        this.title=\"Group Chat\";\r\n        this.users = [];\r\n        this.messages =  [];\r\n        this.selected = false;\r\n        this.unseenCount = 0;\r\n        this.lastMessage = new MyMessage();\r\n        this.chatType = \"group\";\r\n        this.chatStatus = 2;\r\n        this.setAttributes = ( users  ,messages, selected) => {\r\n            setTimeout(() =>AddGroupChatListner(this.cid), 500)\r\n            \r\n            this.users =users;\r\n            // this.title=user.username;\r\n            this.messages = messages;\r\n            this.selected = selected;\r\n            // this.unseenCount = unseenCount;\r\n            return this;\r\n        }\r\n        this.setValue = (singleChat) => {\r\n            setTimeout(() =>AddGroupChatListner(this.cid), 500)\r\n            // this.cid = singleChat.cid;\r\n            this.users = singleChat.users;\r\n            this.messages =singleChat.messages;\r\n            this.selected = singleChat.selected;\r\n            this.unseenCount = singleChat.unseenCount;\r\n            return this;\r\n        }\r\n    }\r\n}\r\nexport default MyGroupChat;","import MySingleUserChat from \"../../../RTCHAT/mySingleUserChat\";\r\nimport MyUser from \"../../../components/businessLogic/myUser\";\r\nimport { USER_CHAT_DATA_COLLECTOR,SET_CHAT_LIST_CM ,USER_CHAT_SENT_DATA_COLLECTOR,\r\n     USER_CHAT_HANDLE_SELECTD , HANDLE_REMOVE_CHAT, MSG_ACK_ACTION, MSGS_ACK_ACTION, INITIALIZE_CHAT_BETWEEN_CM} from \"../../../RTCHAT/types\";\r\nimport MyGroupChat from \"../../../RTCHAT/myGroupChat\";\r\n\r\nconst state = {\r\n    Chat: [\r\n        // new MySingleUserChat(new MyUser().setAttributes(\"A\", \"atamuhiuldin\")).setAttributes([], false ),\r\n        // new MySingleUserChat(new MyUser().setAttributes(\"B\", \"salman\")).setAttributes([], false ),\r\n        // new MySingleUserChat(new MyUser().setAttributes(\"C\", \"dawood\")).setAttributes([], false), \r\n        // new MyGroupChat(\"ABC\" ).setAttributes([\"A\" , \"B\", \"C\"], [], false),\r\n        // new MyGroupChat(\"CDB\" ).setAttributes([\"A\" , \"B\", \"C\"], [], false)\r\n      ], \r\n    user: {\r\n        _id: \"\", \r\n        username: \"\"\r\n    }\r\n}\r\n\r\n\r\nconst ChatReducer = (mState = {...state}, action) => {\r\n    switch(action.type){\r\n        case SET_CHAT_LIST_CM:\r\n         mState.Chat = action.payload.chat;\r\n            return clone(mState);\r\n        case USER_CHAT_DATA_COLLECTOR:\r\n           \r\n            let message = action.payload.message;\r\n            let ucId = message.chatType === \"group\"? message.to : message.from\r\n            if(message.from !== mState.user._id){\r\n                console.log(\"=========user data collection========\")\r\n                console.log(message)\r\n                let ucIndex = mState.Chat.findIndex(uc => uc.cid === ucId);\r\n                if(ucIndex >= 0){\r\n                    mState.Chat[ucIndex].messages.push(message);\r\n                    mState.Chat[ucIndex].lastMessage = message;\r\n                    \r\n                    mState.Chat.sort((a, b) =>  b.lastMessage.sentTimeDate- a.lastMessage.sentTimeDate)\r\n    \r\n                }else{\r\n                    console.log(\"Undefined user message\")\r\n                    console.log(message);\r\n                }\r\n            }\r\n            mState.Chat.sort((a, b) => b.lastMessage.sentTimeDate - a.lastMessage.sentTimeDate )\r\n            \r\n            return clone(mState);\r\n\r\n        case INITIALIZE_CHAT_BETWEEN_CM:\r\n            const {friend, chat} = action.payload;\r\n            let icbIndex = mState.Chat.findIndex(c => c.cid === friend._id);\r\n            if(icbIndex >= 0){\r\n                mState.Chat[icbIndex]._id = chat._id;\r\n                mState.Chat[icbIndex].chatStatus = MySingleUserChat.USER_CHAT_FOUND;\r\n            }\r\n             return clone(mState);\r\n        case USER_CHAT_SENT_DATA_COLLECTOR:\r\n                console.log(\"=========send data collection========\")\r\n                let messageSent = action.payload.message;\r\n                console.log(messageSent)\r\n                let ucsIndex = mState.Chat.findIndex(uc => uc.cid === messageSent.to);\r\n                if(ucsIndex >= 0){\r\n                    mState.Chat[ucsIndex].messages.push(messageSent);\r\n                    mState.Chat[ucsIndex].lastMessage = messageSent;\r\n                mState.Chat.sort((a, b) => b.lastMessage.sentTimeDate - a.lastMessage.sentTimeDate )\r\n\r\n                }else{\r\n                    console.log(\"Undefined user message\")\r\n                    console.log(messageSent);\r\n                }\r\n                return clone(mState);\r\n        \r\n        case USER_CHAT_HANDLE_SELECTD:\r\n            let cid = action.payload.cid;\r\n            for (let hindex = 0; hindex < mState.Chat.length; hindex++) {\r\n                if( mState.Chat[hindex].cid === cid){\r\n                    mState.Chat[hindex].selected = true\r\n                  \r\n                }else{\r\n                    mState.Chat[hindex].selected = false\r\n                }\r\n              }\r\n            return clone(mState);\r\n        case HANDLE_REMOVE_CHAT:\r\n            mState.Chat = mState.Chat.filter(c => c.cid !== action.payload.cid); \r\n            mState.Chat.sort((a, b) => b.lastMessage.sentTimeDate - a.lastMessage.sentTimeDate )\r\n\r\n            return clone(mState)\r\n        \r\n        case MSG_ACK_ACTION: \r\n              let msg = action.payload.message;\r\n              let status = action.payload.status;\r\n              let ackIndex = mState.Chat.findIndex(c => c.cid === msg.to)\r\n              if(ackIndex >= 0){\r\n                  let ackmIndex = mState.Chat[ackIndex].messages.findIndex(m => m._id === msg._id )\r\n                  if(ackmIndex >= 0){\r\n                      mState.Chat[ackIndex].messages[ackmIndex].status = status;\r\n                  }\r\n              }\r\n              return clone(mState);\r\n\r\n        case MSGS_ACK_ACTION: \r\n            let msgs = action.payload.messages;\r\n            let statuss = action.payload.status;\r\n            let ccid = action.payload.cid;\r\n            let acksIndex = mState.Chat.findIndex(c => c.cid === ccid)\r\n            let markCounter = 0;\r\n            if(acksIndex >= 0){\r\n                for (let msgsIndex = mState.Chat[acksIndex].messages.length -1 ; msgsIndex >= 0 ; msgsIndex--) {\r\n                    const element = mState.Chat[acksIndex].messages[msgsIndex];\r\n                    for (let seenmIndex = 0; seenmIndex < msgs.length; seenmIndex++) {\r\n                        const msgseen = msgs[seenmIndex];\r\n                        if(msgseen._id === element._id){\r\n                            mState.Chat[acksIndex].messages[msgsIndex].status = statuss;\r\n                            markCounter++;\r\n                            break; \r\n                        }\r\n                    }\r\n                    if(markCounter >= msgs.length){\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n              return clone(mState);\r\n        case \"SET_USER\": \r\n              mState.user = action.payload.user;\r\n                  return clone(mState);\r\n        default: \r\n            return clone(mState);\r\n    }\r\n}\r\nexport default ChatReducer;\r\n\r\nconst clone = (obj) =>{\r\n    return JSON.parse(JSON.stringify(obj))\r\n}","export const USER_CHAT_HANDLE_SELECTD =\"USER_CHAT_HANDLE_SELECTD\";\r\nexport const MSG_ACK_ACTION = \"MSG_ACK_ACTION\";\r\nexport const MSGS_ACK_ACTION = \"MSGS_ACK_ACTION\";\r\nexport const USER_CHAT_DATA_COLLECTOR = \"USER_CHAT_DATA_COLLECTOR\";\r\nexport const USER_CHAT_SENT_DATA_COLLECTOR = \"USER_CHAT_SENT_DATA_COLLECTOR\";\r\nexport const HANDLE_REMOVE_CHAT =\"HANDLE_REMOVE_CHAT\";\r\nexport const SET_CHAT_LIST_CM = \"SET_CHAT_LIST_CM\";\r\nexport const INITIALIZE_CHAT_BETWEEN_CM = \"INITIALIZE_CHAT_BETWEEN_CM\";\r\n\r\n\r\n/// CALL ACTIONS \r\nexport const CALL_RUNNING_STATUS = \"CALL_RUNNING_STATUS\";\r\n","\r\nconst state ={\r\n    user: {\r\n        _id: \"\", \r\n        username: \"\"\r\n    }\r\n}\r\n\r\nconst AuthReducer = (mState = {...state}, action) => {\r\n    switch(action.type){\r\n        case \"SET_USER\": \r\n        mState.user = action.payload.user;\r\n            return clone(mState);\r\n\r\n        default: \r\n         return clone(mState);\r\n    }\r\n}\r\nexport default AuthReducer;\r\n\r\nconst clone = (obj) =>{\r\n    return JSON.parse(JSON.stringify(obj))\r\n}","import {combineReducers} from 'redux';\r\n\r\nimport ChatReducer from './chatReducer';\r\nimport AuthReducer from './authReducer';\r\nconst RootReducer = combineReducers({\r\n    ChatReducer, \r\n    AuthReducer\r\n})\r\nexport default RootReducer;","import {createStore, applyMiddleware, compose} from 'redux';\r\nimport RootReducer from './reducers';\r\nimport thunk from 'redux-thunk';\r\nconst middleWare = [thunk]\r\n\r\nconst initialState ={}\r\n\r\n\r\nlet store = null \r\n\r\nif(window.__REDUX_DEVTOOLS_EXTENSION__){\r\n    store = createStore(\r\n        RootReducer, \r\n        initialState, \r\n        compose(applyMiddleware(...middleWare), \r\n        window.__REDUX_DEVTOOLS_EXTENSION__()\r\n        )\r\n    )\r\n}else{\r\n    store = createStore(\r\n        RootReducer, \r\n        initialState, \r\n        compose(applyMiddleware(...middleWare))\r\n    )\r\n}\r\n\r\nexport default store;","import MyCommunicatorObj from './communicator';\r\nimport store from '../store';\r\nimport { USER_CHAT_HANDLE_SELECTD, MSG_ACK_ACTION, \r\n     MSGS_ACK_ACTION ,USER_CHAT_DATA_COLLECTOR, USER_CHAT_SENT_DATA_COLLECTOR,\r\n      HANDLE_REMOVE_CHAT, SET_CHAT_LIST_CM, INITIALIZE_CHAT_BETWEEN_CM } from './types';\r\nimport MyMessage from './myMessage';\r\nimport axios from 'axios';\r\nimport MyUser from '../components/businessLogic/myUser';\r\nimport MySingleUserChat from './mySingleUserChat';\r\nimport MyGroupChat from './myGroupChat';\r\n// import PeerConnection from '../RTC/PeerConnection';\r\nexport const MyCommunicator = new MyCommunicatorObj();\r\nexport const configs =  [\r\n    {\r\n    id:1, \r\n    selected: false,\r\n    value: {iceServers: [\r\n      {urls: \"stun:stun.l.google.com:19302\"}, \r\n      {\r\n          urls: \"turn:numb.viagenie.ca\", \r\n          username: \"ata.mirza40@gmail.com\", \r\n          credential: \"ataMirza12345_\"\r\n      }\r\n      ]}\r\n    }, \r\n    {\r\n      id: 2, \r\n      selected:false,\r\n      value: {iceServers: [\r\n        {url: \"stun:stun.l.google.com:19302\"}\r\n        ]}\r\n    }, \r\n    {\r\n      id:3, \r\n      selected:true,\r\n      value:{iceServers: [\r\n        {url: \"stun:stun.l.google.com:19302\"}, \r\n        {\r\n          urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n          username: 'a9a2b514',\r\n          credential: '00163e7826d6'\r\n        }\r\n        ]}\r\n    }, \r\n    {\r\n      id: 4, \r\n      selected:false, \r\n      value: {\r\n        iceServers: [\r\n          {url: \"stun:stun.l.google.com:19302\"}, \r\n          {\r\n            url: 'turn:192.158.29.39:3478?transport=udp',\r\n            credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n            username: '28224511:1379330808'\r\n          }\r\n        ]\r\n      }\r\n    },\r\n    {\r\n      id: 5, \r\n      selected:false, \r\n      value: {\r\n        iceServers: [\r\n          {url: \"stun:stun.l.google.com:19302\"}, \r\n          {\r\n            \"urls\": [\r\n            \"turn:13.250.13.83:3478?transport=udp\"\r\n            ],\r\n            \"username\": \"YzYNCouZM1mhqhmseWk6\",\r\n            \"credential\": \"YzYNCouZM1mhqhmseWk6\"\r\n            }\r\n        ]\r\n      }\r\n    }, \r\n    {\r\n      id:6, \r\n      selected: false,\r\n      value: {iceServers: [\r\n        {urls: \"stun:stun.l.google.com:19302\"}, \r\n        {\r\n            urls: \"turn:numb.viagenie.ca\", \r\n            username: \"ata.mirza40@gmail.com\", \r\n            credential: \"ataMirza12345_\"\r\n        }\r\n        ], iceTransports: \"relay\"\r\n       }\r\n      }, \r\n    {\r\n      id: 7, \r\n      selected: false, \r\n      value: {iceServers: [\r\n        {url: \"stun:stun.l.google.com:19302\"}, \r\n        {\r\n        urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n        username: 'a9a2b514',\r\n        credential: '00163e7826d6'\r\n      }]}\r\n    }, \r\n    {\r\n      id: 8, \r\n      selected: false, \r\n      value: {iceServers: [\r\n        {\r\n        urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n        username: 'a9a2b514',\r\n        credential: '00163e7826d6'\r\n      }]}\r\n    }\r\n]\r\n\r\n\r\nconst MyGroupChatCommunicators = [];\r\nlet peerConnection = null;\r\nexport const loadAllChats = () => {\r\n\r\n\r\n\r\n    axios.post(\"http://localhost:5000/API/user/auth/get-all\")\r\n        .then(res =>{\r\n            if(res.data.success){\r\n                let chatData = res.data.users;\r\n                let myChat = [];\r\n                for (let index = 0; index < chatData.length; index++) {\r\n                    const singleChat = chatData[index];\r\n                    myChat.push(new MySingleUserChat(new MyUser().setValue(singleChat)).setAttributes([], false ))\r\n                }\r\n           \r\n                store.dispatch({\r\n                    type: SET_CHAT_LIST_CM, \r\n                    payload: {chat: myChat}\r\n                })\r\n            }else{\r\n                console.log(\"ERROR SUCCESS:FALSE\");\r\n                console.log(res.data.error);\r\n            }\r\n        }).catch(err =>{\r\n            console.log(\"CATCH: API, NETWORK ERROR\")\r\n            console.log(err);\r\n        })\r\n}\r\n\r\nexport const prepareChat =  (userId) => {\r\n    axios.post(\"http://localhost:5000/API/user/chat/user-chat\", {userId: userId})\r\n        .then(res =>{\r\n            if(res.data.success){\r\n                let incomingChat = res.data.user.userChat;\r\n                let myChat = [...store.getState().ChatReducer.Chat];\r\n                let newChat = [];\r\n\r\n                //// merging \r\n                for (let iIndex = 0; iIndex < incomingChat.length; iIndex++) {\r\n                    const ic = incomingChat[iIndex];\r\n                    let icfound = false;\r\n                    for (let mIndex = 0; mIndex < myChat.length; mIndex++) {\r\n                        const mc = myChat[mIndex];\r\n                        \r\n                        if(mc.cid === ic.cid){\r\n                            icfound = true;\r\n                            mc._id = ic._id;\r\n                            mc.messages = ic.messages;\r\n                            mc.chatStatus = MySingleUserChat.USER_CHAT_FOUND;\r\n                            // mc.title = ic.title;\r\n                            newChat.push(mc);\r\n                            break;\r\n                        }\r\n                    }\r\n                    if(!icfound){\r\n                        ic.chatStatus = MySingleUserChat.USER_CHAT_FOUND;\r\n                        if(ic.chatType === \"group\"){\r\n                            newChat.push( new MyGroupChat(ic._id).setValue(ic) );\r\n                        }else{\r\n                            // newChat.push(ic);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                for (let mmIndex = 0; mmIndex < myChat.length; mmIndex++) {\r\n                    const mmc = myChat[mmIndex];\r\n                    let mmcfound = false;\r\n                    for (let iiIndex = 0; iiIndex < incomingChat.length; iiIndex++) {\r\n                        const iic = incomingChat[iiIndex];\r\n                        if(mmc.cid === iic.cid){\r\n                            mmcfound = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if(!mmcfound){\r\n                        newChat.push(mmc);\r\n                    }\r\n                }\r\n            \r\n\r\n            \r\n                    store.dispatch({\r\n                        type: SET_CHAT_LIST_CM, \r\n                        payload: {chat: newChat}\r\n                    })\r\n            }else{\r\n            }\r\n        }).catch(err => {\r\n            console.log(\"CATCH: Error\");\r\n            console.log(err);\r\n        })\r\n}\r\n\r\nexport const initializeChat = (userId, friendId) => {\r\n    axios.post(\"http://localhost:5000/API/user/chat/initialize-chat\", {userId: userId, friendId: friendId})\r\n        .then(res => {\r\n            if(res.data.success){\r\n                store.dispatch({\r\n                    type: INITIALIZE_CHAT_BETWEEN_CM,\r\n                    payload: {friend: res.data.friend, chat: res.data.chat} \r\n                })\r\n            }else{\r\n                console.log(\"INIT CHAT SUCCESS: FALSE\")\r\n                console.log(res.data.error)\r\n            }\r\n        }).catch(err => {\r\n            console.log(\"CATCH: INITIALIZE CHAT\")\r\n            console.log(err);\r\n        })\r\n}\r\n\r\nexport const setUserChatSelected = (cid) => {\r\n    store.dispatch({\r\n        type: USER_CHAT_HANDLE_SELECTD, \r\n        payload: {cid: cid}\r\n    })\r\n}\r\n\r\nconst ackEmitter = (message, status) => {\r\n    store.dispatch({\r\n        type: MSG_ACK_ACTION, \r\n        payload: {message: message, status}\r\n    })\r\n}\r\nconst ackEmitters = (messages, cid ,status) => {\r\n    store.dispatch({\r\n        type: MSGS_ACK_ACTION, \r\n        payload: {messages: messages, cid:cid ,status:status}\r\n    })\r\n}\r\n\r\nconst dataHandler = (message) => {\r\n  store.dispatch({\r\n      type: USER_CHAT_DATA_COLLECTOR, \r\n      payload: {message: message}\r\n  })\r\n}\r\n\r\nconst sentDataHandler = (message) => {\r\n     store.dispatch({\r\n         type: USER_CHAT_SENT_DATA_COLLECTOR, \r\n         payload: {message: message}\r\n     })\r\n   }\r\n\r\nexport const connectChat = (cid) => {\r\n    MyCommunicator.connect(cid, dataHandler, ackEmitter, ackEmitters);\r\n    store.dispatch({\r\n        type: HANDLE_REMOVE_CHAT, \r\n        payload: {cid: cid}\r\n    })\r\n}\r\nexport const sendMessage = (message, chatId) => {\r\n    MyCommunicator.send(message, chatId)\r\n    sentDataHandler(message)\r\n}\r\n\r\n\r\n\r\n\r\nexport const markSeen = (cid) => {\r\n    let chat = store.getState().ChatReducer.Chat;\r\n    let cIndex = chat.findIndex(c => c.cid === cid);\r\n    if(cIndex >= 0){\r\n        let messages = chat[cIndex].messages.filter(m => ((m.status === MyMessage.SENDING || m.status === MyMessage.RECIEVED || m.status === MyMessage.SENT) && m.from === cid ))\r\n        MyCommunicator.markSeen(messages, cid);\r\n    }\r\n}\r\n\r\n\r\n\r\n////// Add Group Chat Listner\r\n\r\n\r\nexport const AddGroupChatListner = (gcid) => {\r\n    MyGroupChatCommunicators.push(new MyCommunicatorObj().connect(gcid, dataHandler, ackEmitter, ackEmitter));\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n////////////////////////////////////////////////////////////////////\r\n///////////////////// VIDEO CHAT ////////////////////////////////////\r\n//////////////////////////////////////////////////////////////////////////\r\n\r\n\r\n\r\nexport const setSelected = (id) => {\r\n    // let configsn = [configs]\r\n    for (let index = 0; index < configs.length; index++) {\r\n      const c = configs[index];\r\n      if(c.id === id){\r\n        configs[index].selected = true;\r\n      }else{\r\n        configs[index].selected = false;\r\n      }\r\n    }\r\n    // configs =  configsn;\r\n    return configs;\r\n  }\r\n\r\nconst getSelected = () => {\r\n    return configs.filter(c => c.selected === true)[0].value;\r\n  }\r\n\r\n \r\n//   export const createRTCConnection = (context,myId, peerId) => {\r\n//     MyCommunicator.rtcConnectionManager.createConnection(myId, peerId, getSelected())\r\n//     MyCommunicator.videoChatContext =context\r\n// }\r\n\r\n\r\n\r\n\r\n// export const startRTCCall = (context, myId, reciever) => {\r\n//     MyCommunicator.createRTCConnection(context, myId, reciever,getSelected() )\r\n// }\r\n\r\n// export const setCallChannelStates = (kind, value) => {\r\n    //     peerConnection.setChannelEnabled(kind, !this.state.isMute);\r\n    // }\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    //////////////////////////\r\n    \r\n    \r\nexport const initiazlizeRTCCall = (to) => {\r\n       MyCommunicator.initializeSignaling( to);\r\n}\r\nexport const answerRTCCall = () => {\r\n  console.log(\"ANSWER CALL\")\r\n  MyCommunicator.acceptCall()\r\n}\r\nexport const setRTCCallContext = (context) => {\r\n    MyCommunicator.setChatContext(context)\r\n}\r\nexport const endRTCCall = () => {\r\n    MyCommunicator.destroyRTCConnection();\r\n    MyCommunicator.endCallSignal()\r\n}","export const setUser = (user) => dispatch =>{\r\n    dispatch({\r\n        type: \"SET_USER\", \r\n        payload: {user: user}\r\n    })\r\n}","import React from 'react';\r\nimport TextMessage from './textMessage';\r\nimport { sendMessage, markSeen, initializeChat} from '../RTCHAT'\r\nimport MyMessage from '../RTCHAT/myMessage';\r\nimport {connect} from 'react-redux';\r\nimport {setUser } from '../store/actions/authActions';\r\nimport MySingleUserChat from '../RTCHAT/mySingleUserChat';\r\nconst PRIMARY = \"#5BBC93\"\r\nconst SECONDRY = \"white\";\r\n\r\n\r\nclass SingleChat extends React.Component{\r\n  state={\r\n   \r\n\r\n    messageBody: \"\", \r\n    chat: []\r\n  }\r\n\r\n  handleSendMesage = (friend, chatId ,cid, chatType) => {\r\n      this.setState({messageBody: \"\"})\r\n      let message = null;\r\n      if(chatType === \"group\"){\r\n        message =  new MyMessage().setAttributes(cid, friend, this.state.messageBody).setAsGroupMessage()\r\n      }else{\r\n        message =  new MyMessage().setAttributes(cid, friend, this.state.messageBody)\r\n      }\r\n      sendMessage(message, chatId)\r\n  }\r\n\r\n \r\n\r\n  render(){\r\n      const userChat = this.props.userChat.filter(uc => uc.selected === true)[0];\r\n     \r\n       if(!userChat){\r\n           return false\r\n       }\r\n       if(userChat.chatStatus !== MySingleUserChat.USER_CHAT_FOUND){\r\n          return (\r\n            <div>\r\n                <button onClick={() => initializeChat( this.props.user._id, userChat.user._id)}>Initialize Chat with {userChat.title}</button>\r\n            </div>\r\n          )\r\n       }\r\n  return (\r\n    <div style={{width: \"100%\", height: \"100%\"}}>\r\n       <div style={{width: \"100%\",  height: 100, backgroundColor: PRIMARY}}>\r\n          {/* <div style={{width: \"100%\"}}>\r\n              {\r\n                  this.props.userChat.map(uc => \r\n                  <button onClick={() => this.handleConnect(uc)} style={{backgroundColor: uc.reserved? PRIMARY: SECONDRY, border: \"2px solid \"+uc.reserved? SECONDRY: PRIMARY, borderRadius: 30 }}>\r\n                        <span style={{color: uc.reserved? SECONDRY :PRIMARY, fontSize: 18}}>{uc.title}</span>\r\n                  </button>)\r\n              }\r\n          </div> */}\r\n            <span style={{fontSize: 30, color: \"white\", marginLeft: 20}}>{userChat.title}</span>\r\n          {/* <input value={this.state.uid} onChange={(e) => this.setState({uid: e.target.value})} style={{borderRadius: 30, padding: 5, color: PRIMARY}} placeholder=\"your name\"/>\r\n          <input value={this.state.friend} onChange={(e) => this.setState({friend: e.target.value})} style={{borderRadius: 30, padding: 5, color: PRIMARY}} placeholder=\"frient name\"/> */}\r\n\r\n          \r\n       </div>\r\n       <div style={{height: 550, width: \"100%\", overflowY: \"scroll\", backgroundColor: \"white\"}}>\r\n\r\n        {\r\n            userChat.messages.map((m, index) => <div key={index}><TextMessage message={m} cid={this.props.user._id}/><br/></div>)\r\n        }\r\n\r\n\r\n\r\n       </div>\r\n       <div style={{width: \"100%\", height: 70, backgroundColor: SECONDRY}}>\r\n     \r\n     \r\n        <input onFocus={() => markSeen(userChat.cid)} value={this.state.messageBody} onChange={(e) => this.setState({messageBody: e.target.value})} style={{borderRadius: 30, padding: 5, color: PRIMARY, width: \"70%\", height: 55, fontSize: 25}} placeholder=\"frient name\"/>\r\n      \r\n      \r\n        <button onClick={() => this.handleSendMesage(userChat.cid, userChat._id ,this.props.user._id, userChat.chatType)} style={{backgroundColor: PRIMARY, border: \"2px solid \"+SECONDRY, borderRadius: 30, width: \"20%\", height: 55 }}>\r\n          <span style={{color: SECONDRY, fontSize: 18}}>SEND</span>\r\n        </button>\r\n\r\n       </div>\r\n    </div>\r\n  );\r\n  }\r\n}\r\n\r\nexport default connect(null, {setUser})(SingleChat);\r\n","import React, { Component } from 'react';\r\nimport {setUserChatSelected} from '../RTCHAT'\r\nconst PRIMARY = \"#5BBC93\"\r\n// const SECONDRY = \"white\";\r\n\r\nclass SingleUserChat extends Component {\r\n    state = {  }\r\n    render() { \r\n        const uc = this.props.singleChat;\r\n        const lastMessage = uc.messages.length > 0 ? uc.messages[uc.messages.length-1].body: false\r\n        const unseenCount = uc.messages.unseenCount;\r\n        return ( \r\n            <div onClick={() => setUserChatSelected(uc.cid)} style={{ cursor:\"pointer\",width: \"100%\", height: 100, backgroundColor: uc.selected? \"#EBEBEB\": \"white\", borderBottom: \"2px solid #f0f0f0\" }}>\r\n              <div align=\"center\" style={{ width: \"30%\", height: \"100%\" ,float:\"left\" ,borderRadius: 50, border: \"1px solid #f0f0f0\"}}>\r\n               { unseenCount > 0 ? <div align=\"center\"  style={{ marginTop:\"40%\" ,zIndex: 99, backgroundColor: PRIMARY , borderRadius: 50, width: \"25px\", height: \"25px\"}}> \r\n                    {unseenCount}\r\n                </div>: false}\r\n                   \r\n                </div>\r\n              <div style={{width: \"65%\", float: \"right\"}}>\r\n                <span style={{fontSize: 25, width: \"100%\", textAlign: \"center\"}}>{uc.title}</span><br/>\r\n                <span style={{textOverflow: \"ellipsis\"}}>{lastMessage}</span>\r\n              </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n \r\nexport default SingleUserChat;","import React from 'react';\r\n\r\n// import PeerConnection from '../RTC/PeerConnection';\r\nimport {setRTCCallContext, initiazlizeRTCCall, endRTCCall, answerRTCCall, connectChat} from '../RTCHAT'\r\nimport CallStatus from '../RTCHAT/CALL_SIGNALING/callStatus';\r\nclass VideoCallingScreen extends React.Component {\r\n  \r\n  \r\n  constructor(){\r\n    super()\r\n\r\n    // this.myStream = React.createRef();\r\n    // this.friendStream = React.createRef();\r\n\r\n  this.state = {\r\n    localStream: null, \r\n    peerStream:null, \r\n    isConnected: false, \r\n    myId: \"\", \r\n    friendId: \"\", \r\n    callRunning: false, \r\n    isMute: false,\r\n    connectionState: \"\", \r\n    callStatus: -1,\r\n    configs:  [\r\n      {\r\n      id:1, \r\n      selected: false,\r\n      value: {iceServers: [\r\n        {urls: \"stun:stun.l.google.com:19302\"}, \r\n        {\r\n            urls: \"turn:numb.viagenie.ca\", \r\n            username: \"ata.mirza40@gmail.com\", \r\n            credential: \"ataMirza12345_\"\r\n        }\r\n        ]}\r\n      }, \r\n      {\r\n        id: 2, \r\n        selected:false,\r\n        value: {iceServers: [\r\n          {url: \"stun:stun.l.google.com:19302\"}\r\n          ]}\r\n      }, \r\n      {\r\n        id:3, \r\n        selected:true,\r\n        value:{iceServers: [\r\n          {url: \"stun:stun.l.google.com:19302\"}, \r\n          {\r\n            urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n            username: 'a9a2b514',\r\n            credential: '00163e7826d6'\r\n          }\r\n          ]}\r\n      }, \r\n      {\r\n        id: 4, \r\n        selected:false, \r\n        value: {\r\n          iceServers: [\r\n            {url: \"stun:stun.l.google.com:19302\"}, \r\n            {\r\n              url: 'turn:192.158.29.39:3478?transport=udp',\r\n              credential: 'JZEOEt2V3Qb0y27GRntt2u2PAYA=',\r\n              username: '28224511:1379330808'\r\n            }\r\n          ]\r\n        }\r\n      },\r\n      {\r\n        id: 5, \r\n        selected:false, \r\n        value: {\r\n          iceServers: [\r\n            {url: \"stun:stun.l.google.com:19302\"}, \r\n            {\r\n              \"urls\": [\r\n              \"turn:13.250.13.83:3478?transport=udp\"\r\n              ],\r\n              \"username\": \"YzYNCouZM1mhqhmseWk6\",\r\n              \"credential\": \"YzYNCouZM1mhqhmseWk6\"\r\n              }\r\n          ]\r\n        }\r\n      }, \r\n      {\r\n        id:6, \r\n        selected: false,\r\n        value: {iceServers: [\r\n          {urls: \"stun:stun.l.google.com:19302\"}, \r\n          {\r\n              urls: \"turn:numb.viagenie.ca\", \r\n              username: \"ata.mirza40@gmail.com\", \r\n              credential: \"ataMirza12345_\"\r\n          }\r\n          ], iceTransports: \"relay\"\r\n         }\r\n        }, \r\n      {\r\n        id: 7, \r\n        selected: false, \r\n        value: {iceServers: [\r\n          {url: \"stun:stun.l.google.com:19302\"}, \r\n          {\r\n          urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n          username: 'a9a2b514',\r\n          credential: '00163e7826d6'\r\n        }]}\r\n      }, \r\n      {\r\n        id: 8, \r\n        selected: false, \r\n        value: {iceServers: [\r\n          {\r\n          urls: 'turn:turn.msgsafe.io:443?transport=tcp',\r\n          username: 'a9a2b514',\r\n          credential: '00163e7826d6'\r\n        }]}\r\n      }\r\n  ]\r\n\r\n  }\r\n  this.peerConnectionA = null\r\n\r\n}\r\n\r\ncomponentDidMount(){\r\n  //// STEP # 1\r\n  setRTCCallContext(this);\r\n}\r\n\r\nconnectUser = () => {\r\n    if(this.state.myId !== \"\" && this.state.friendId !== \"\"){\r\n      console.log(\"STATE\")\r\n      console.log(this.state);\r\n      connectChat( this.state.myId);\r\n    }else{\r\n      alert(\"Invalid USER or FRIEND Id\")\r\n    }\r\n}\r\n\r\n\r\n\r\nhandleInitiateCall = ( ) => {\r\n    initiazlizeRTCCall(this.state.friendId);\r\n}\r\n\r\nendCall = () => {\r\n    endRTCCall();\r\n}\r\nanswerCall = () => {\r\n  answerRTCCall()\r\nthis.setState({callStatus: CallStatus.ACCEPTED})\r\n}\r\n\r\nsetSelected = (id) => {\r\n  let configs = [...this.state.configs]\r\n  for (let index = 0; index < configs.length; index++) {\r\n    const c = configs[index];\r\n    if(c.id === id){\r\n      configs[index].selected = true;\r\n    }else{\r\n      configs[index].selected = false;\r\n    }\r\n  }\r\n  this.setState({configs: configs})\r\n}\r\n\r\ngetSelected = () => {\r\n  return this.state.configs.filter(c => c.selected === true)[0].value;\r\n}\r\n\r\n\r\n\r\nrender(){\r\n  if(this.myStream){\r\n    this.myStream.srcObject = this.state.localStream; \r\n    this.friendStream.srcObject = this.state.peerStream;\r\n  }\r\n\r\n  switch(this.state.callStatus){\r\n    case CallStatus.RINGING_REQUEST: \r\n      return (\r\n        <div style={{backgroundColor: \"#363442\" ,width: \"100%\", height: window.innerHeight}}>\r\n          <div align=\"center\" style={{alignSelf: \"center\"}}>\r\n            <div style={{height: 200}}/>\r\n            <span style={{color: \"white\", fontSize: 30}}>Ringing...</span><br/>\r\n            <div style={{height: 50}}/>\r\n            <button onClick={() => this.answerCall()} style={{width: 100, height: 50, backgroundColor: \"green\", border: \"0px\", borderRadius: 50, color: \"white\", fontSize: 20}}>Accept</button>\r\n            <button onClick={() => this.endCall()} style={{width: 100, height: 50, backgroundColor: \"red\", border: \"0px\", borderRadius: 50, color: \"white\", fontSize: 20}}>CANCEL</button>\r\n\r\n          </div>\r\n        </div>\r\n      )\r\n\r\n      case CallStatus.RINGING: \r\n      return (\r\n        <div style={{backgroundColor: \"#363442\" ,width: \"100%\", height: window.innerHeight}}>\r\n          <div align=\"center\" style={{alignSelf: \"center\"}}>\r\n            <div style={{height: 200}}/>\r\n            <span style={{color: \"white\", fontSize: 30}}>Ringing...</span><br/>\r\n            <div style={{height: 50}}/>\r\n            <button onClick={() => this.endCall()} style={{width: 100, height: 50, backgroundColor: \"red\", border: \"0px\", borderRadius: 50, color: \"white\", fontSize: 20}}>CANCEL</button>\r\n          </div>\r\n        </div>\r\n      )\r\n\r\n    case CallStatus.ACCEPTED: \r\n        return (\r\n          <div style={{backgroundColor: \"#363442\" ,width: \"100%\", height: window.innerHeight}}>\r\n             <video ref={e => this.friendStream = e} style={{width: \"100%\" ,height: window.innerHeight, backfaceVisibility:\"visible\"}} autoPlay />\r\n             <video ref={e => this.myStream = e} style={{width: 200, zIndex: 999  , position:\"absolute\", bottom: 10, right: 10 , height: 200, backfaceVisibility:\"visible\"}} autoPlay />\r\n             <button onClick={() => this.endCall()} align=\"center\" style={{position: \"absolute\", backgroundColor:\"red\", width: 60, height: 60, color: \"white\" ,borderRadius: 50, border: \"0px\" ,bottom: 30, left: (window.innerWidth/2)-10}}>END</button>\r\n          </div>\r\n        )\r\n    default: \r\n    return (\r\n      <div className=\"App\">\r\n        <h1 align=\"center\">CHAT APPLICATIONS</h1>\r\n           <div style={{height: 100}}/>\r\n         { this.state.isConnected? \r\n         <React.Fragment>\r\n           <h2 align=\"center\">{`ME: ${this.state.myId}, FRIEND: ${this.state.friendId}`}</h2>\r\n          <div style={{paddingLeft: \"32%\", width: \"100%\"}}>\r\n              <button  style={{width: 300, height: 50, borderRadius: 30, margin:\"auto\"}} onClick={() => this.handleInitiateCall()}>START CALL</button>\r\n          </div>\r\n         </React.Fragment>:  \r\n         <React.Fragment>\r\n         <div style={{width: \"100%\", paddingLeft: \"34%\"}}>\r\n           <span style={{fontSize: 30}}>Me:</span><br/>\r\n           <input style={{borderRadius: 20, padding: 10, fontSize: 20}}  value={this.state.myId}  onChange={(e) => this.setState({myId: e.target.value})}  type=\"text\"/>\r\n          </div>\r\n          <div style={{width: \"100%\",paddingLeft: \"34%\"}}>\r\n           <span style={{fontSize: 30}}>Friend:</span><br/>\r\n           <input style={{borderRadius: 20, padding: 10, fontSize: 20}} value={this.state.friendId}  onChange={(e) => this.setState({friendId: e.target.value})}  type=\"text\"/>\r\n          </div>\r\n          <div style={{height: 30}}/>\r\n\r\n          <div style={{paddingLeft: \"32%\", width: \"100%\"}}>\r\n           <button  style={{width: 300, height: 50, borderRadius: 30, margin:\"auto\"}} onClick={() => this.connectUser()}>Connect</button>\r\n          </div></React.Fragment>}\r\n            {/* <button onClick={() => this.handleInitiateCall()}>Call</button> */}\r\n            {/* <button onClick={() => this.answerCall(true)}>Answer</button> */}\r\n          {/* <video ref={e => this.friendStream = e} style={{width: \"100%\" ,background:\"#f0f0f0\" ,height: 500, backfaceVisibility:\"visible\"}} autoPlay />\r\n          <video ref={e => this.myStream = e} style={{width: 200, zIndex: 999  , position:\"absolute\", bottom: 10, right: 10 , height: 200, backfaceVisibility:\"visible\"}} autoPlay /> */}\r\n      </div>\r\n    );\r\n  }\r\n  \r\n}\r\n\r\n}\r\n\r\nexport default VideoCallingScreen;\r\n","import React from 'react';\nimport SingleChat from './components/singleChat'\nimport SingleUserChat from './components/singleUserChat'\nimport {connectChat, prepareChat} from './RTCHAT'\nimport {setUser} from './store/actions/authActions'\nimport {connect} from 'react-redux';\n// import TextMessage from './components/textMessage';\nimport {loadAllChats} from './RTCHAT'\nimport VideoChatScreen from './components/videoChatScreen'\nconst PRIMARY = \"#5BBC93\"\nconst SECONDRY = \"white\";\n\nclass App extends React.Component{\n\n\n  state={\n    calling: true\n  }\n\n  handleConnect = (uc) => {\n    connectChat(uc.cid);\n   \n    prepareChat(uc.cid)\n    this.props.setUser(uc.user);\n    \n  }\n  componentDidMount() {\n    // loadAllChats()\n  }\n \n\n\n\n\n  render(){\n\n    if(this.state.calling){\n      return (\n        <VideoChatScreen/>\n      )\n    }\n\n  return (\n    \n    <div key={0} style={{width: \"100%\", height: \"100%\"}}>\n     \n\n\n\n     { this.props.user._id !== \"\" ?\n      (<div  key={1} style={{width: \"100%\", height: 700 }}>\n         <div  key={2} style={{width: \"20%\", height: \"100%\", backgroundColor: \"white\", float:\"left\"}}>\n          <div  key={3} style={{width: \"100%\", height: 100, textAlign:\"center\"}}>\n            <span  key={4} style={{fontSize: 25, color: PRIMARY}}>{this.props.user.username}</span>\n          </div>\n          {\n            this.props.userChat.map((sc, index) => <SingleUserChat key={index} singleChat={sc}/> )\n          }\n         \n        </div>\n        <div  key={5} style={{width: \"80%\", float:\"right\"}}>\n          <SingleChat  key={6} user={this.props.user} userChat={this.props.userChat} onConnect={this.handleConnectSocket} onSendMessage={this.handleSendMessage}/>\n        </div>\n      </div>) :\n      <div  key={7} align=\"center\" style={{margin:\"auto\", marginTop: 100}}>\n        \n              {\n                  this.props.userChat.map((uc, index) => \n                  <button key={index} onClick={() => this.handleConnect(uc)} style={{ width: \"200px\", height: \"100px\", cursor:\"pointer\" , border: \"2px solid \"+uc.reserved? SECONDRY: PRIMARY, borderRadius: 30 }}>\n                        <span style={{color: uc.reserved? SECONDRY :PRIMARY, fontSize: 18}}>{uc.title}</span>\n                  </button>)\n              }\n       </div>}\n    </div>\n   \n  );\n  }\n}\n\nconst mapStateToProps = state => ({\n  userChat: state.ChatReducer.Chat, \n  user: state.AuthReducer.user\n})\nexport default connect(mapStateToProps, {setUser})(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport {Provider} from 'react-redux'\nimport store from './store'\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}